(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[363],{63238:function(e,t,a){"use strict";a.r(t),a.d(t,{cardClasses:function(){return o.Z},default:function(){return n.Z},getCardUtilityClass:function(){return o.y}});var n=a(65984),o=a(43874)},60024:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return n.Z},getTypographyUtilityClass:function(){return o.f},typographyClasses:function(){return o.Z}});var n=a(85269),o=a(61041)},90154:function(e,t,a){Promise.resolve().then(a.bind(a,63238)),Promise.resolve().then(a.bind(a,60024)),Promise.resolve().then(a.bind(a,5127))},5127:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return C}});var n=a(57437),o=a(1274),s=a(85269),r=a(33457),i=a(2265),c=a(93046),l=a(79245),d=a(52653),m=a(59782),u=(0,m.Z)((0,n.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add"),h=a(11854),p=e=>{let{state:t,setState:a,setEdit:o,edit:s}=e,m=(0,c.v9)(e=>e.product_data.PRODUCT_DATA),p=(0,c.v9)(e=>e.product_data.loading);(0,c.v9)(e=>e.shop_data.SHOP_DATA),(0,c.v9)(e=>e.user_data.USER_DATA),(0,c.v9)(e=>e.shop_data.CATEGORYS);let _=(0,c.I0)(),y=(0,i.useMemo)(()=>[{accessorKey:"name",header:"Product",size:150},{accessorKey:"price",header:"Price",size:150},{accessorKey:"stock",header:"Stock Quantity",size:150},{accessorKey:"category",header:"Sub Category",size:150}],[]);return(0,n.jsx)(r.P2,{initialState:{density:"compact"},options:{columnResizing:!0,width:"100vw"},state:{isLoading:p},columns:y,data:m,enableRowActions:!0,renderRowActions:e=>{let{row:t}=e;return(0,n.jsx)(l.Z,{sx:{display:"flex",gap:"1rem"},className:"items-baseline",children:(0,n.jsx)(d.Z,{size:"small",sx:{background:"green",":hover":{background:"#a039a9"}},color:"success",onClick:()=>{let{name:e,cost:a,price:n,warenty:o,modal:s,id:r}=m[t.id];_((0,h.SA)({name:e,cost:a,price:n,warenty:o,modal:s,id:r,qty:1}))},children:(0,n.jsx)(u,{sx:{color:"white"},fontSize:"small"})})})}})},_=a(64111),y=a(49050);function v(){let[e,t]=i.useState(!1);return(0,n.jsxs)(i.Fragment,{children:[(0,n.jsx)(y.Z,{variant:"contained",onClick:()=>{t(!0)},children:"Select Invoice Items"}),(0,n.jsx)(_.ZP,{BackdropProps:{invisible:!0},anchor:"bottom",open:e,onClose:()=>{t(!1)},children:(0,n.jsxs)("div",{className:"p-2",children:[(0,n.jsx)(s.Z,{variant:"h6",children:"Select Items"}),(0,n.jsx)(p,{})]})})]})}var T=a(47042),g=a(81679),x=(0,m.Z)((0,n.jsx)("path",{d:"M19 13H5v-2h14v2z"}),"Remove"),f=a(53216),I=a(24086),N=a(90517),A=a(42307),O=a(3291);function C(){let[e,t]=(0,i.useState)(""),[a,m]=(0,i.useState)(!1),[p,_]=(0,i.useState)(""),[C,j]=(0,i.useState)(!1),[S,E]=(0,i.useState)(!1),[b,D]=(0,i.useState)(""),M=(0,c.I0)(),P=new Date,Z=P.getFullYear(),R=new Intl.DateTimeFormat("en-US",{month:"numeric"}).format(P),w=new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}),z=P.getDate(),k="".concat(Z,"/").concat(R,"/").concat(z),G=(0,c.v9)(e=>e.product_data.PRODUCT_DATA),[V,L]=i.useState(""),U=(0,c.v9)(e=>e.invoice_data.INVOICE_ITEM),q=(0,c.v9)(e=>e.dashboard_data.MONTH_INCOME),K=(0,c.v9)(e=>e.invoice_data.GRAND_TOTAL_COST),J=(0,c.v9)(e=>e.invoice_data.GRAND_TOTAL),B=(0,c.v9)(e=>e.shop_data.SHOP_DATA),F=(0,c.v9)(e=>e.user_data.USER_DATA),X=(0,c.v9)(e=>e.shop_data.loading),H=(0,i.useMemo)(()=>[{accessorKey:"name",header:"Product",size:200},{accessorKey:"qty",header:(0,n.jsxs)("div",{className:"text-center",children:[" ","Qty"]}),size:50,Cell:e=>{let{renderedCellValue:t,row:a}=e;return(0,n.jsxs)(l.Z,{sx:{display:"flex",gap:"1rem",alignItems:"center"},children:[(0,n.jsx)(d.Z,{size:"small",color:"success",onClick:()=>{M((0,h.hc)(a.id))},children:(0,n.jsx)(u,{fontSize:"small"})}),(0,n.jsx)("h4",{children:t}),(0,n.jsx)(d.Z,{size:"small",color:"success",onClick:()=>{M((0,h.Cj)(a.id))},children:(0,n.jsx)(x,{fontSize:"small"})})]})}},{accessorKey:"warenty",header:"Warranty",size:50},{accessorKey:"price",header:(0,n.jsx)("div",{style:{position:"relative",textAlign:"left"},children:(0,n.jsx)("div",{className:"text-end",children:"Unit Price Rs"})}),size:50,Cell:e=>{let{renderedCellValue:t,row:a}=e;return(0,n.jsx)("div",{className:"flex justify-start",children:(0,n.jsxs)(s.Z,{className:"text-end",children:["Rs. ",t]})})}}]),Q=async()=>{if(0===p.length&&j(!0),0===e.length&&m(!0),0===b.length&&E(!0),0===U.length&&M((0,N.mX)({open:!0,type:"error",msg:"Select Billing Items"})),p.length>0&&e.length>0&&b.length>0&&U.length>0){E(!1),m(!1),j(!1);let t={name:p,mobile:e,payment_history:[{payment:parseFloat(b),date:I.EK.fromDate(P)}],payment:parseFloat(b),blance:parseFloat(b)<J,items:U.map(e=>{let{cost:t,id:a,...n}=e;return n}),date:I.EK.fromDate(P),invoice_id:B.invoice_number+1,grand_total:J,total_cost:K},a=(0,I.ad)(),n=F.shop_id,o=(0,I.hJ)((0,I.JU)(a,"invoice",n),Z.toString());try{for(let e of(await (0,I.ET)(o,t),await (0,I.r7)((0,I.JU)(a,"shop",n),{invoice_number:B.invoice_number+1}),U)){let t=G.find(t=>t.id===e.id);if(t){let a=t.stock-e.qty,n={["/shop/".concat(F.shop_id,"/").concat(t.id,"/stock")]:a};try{await (0,A.Vx)((0,A.iH)((0,A.N8)()),n)}catch(e){(0,N.mX)({open:!0,type:"error",msg:"".concat(t.name," inventory quantity not updated. Error: ").concat(e)})}}}if(M((0,O.wn)({open:!0,data:{name:p,mobile:e,items:U,grand_total:J,payment:b,invoice_num:B.invoice_number+1,date:"".concat(P.getFullYear(),"/").concat(P.getMonth()+1,"/").concat(P.getDate()),time:w.format(P)}})),0===Object.keys(q).length){console.log("obj not exsist");let e=(0,I.JU)((0,I.hJ)((0,I.ad)(),"dashboard",n,Z.toString()),(P.getMonth()+1).toString()),t={day_income:{[P.getDate()]:{amount:J,cost:K}},total_income:J,total_cost:K};try{await (0,I.pl)(e,t)}catch(e){console.log(e)}}else if(q.day_income["".concat(P.getDate())]){let e=(0,I.JU)((0,I.hJ)((0,I.ad)(),"dashboard",n,Z.toString()),(P.getMonth()+1).toString()),t={day_income:{...q.day_income,[P.getDate()]:{amount:q.day_income[P.getDate()].amount+J,cost:q.day_income[P.getDate()].cost+K}},total_income:q.total_income+J,total_cost:q.total_cost+K};try{await (0,I.r7)(e,t)}catch(e){(0,N.mX)({open:!0,type:"error",msg:e})}}else{console.log("obj exsist no day");let e=(0,I.JU)((0,I.hJ)((0,I.ad)(),"dashboard",n,Z.toString()),(P.getMonth()+1).toString());try{await (0,I.r7)(e,{["day_income.".concat(P.getDate())]:{amount:J,cost:K},total_income:q.total_income+J,total_cost:q.total_cost+K})}catch(e){(0,N.mX)({open:!0,type:"error",msg:e})}}M((0,N.mX)({open:!0,type:"success",msg:"Bill Updated"})),M((0,h.BO)()),D("")}catch(e){(0,N.mX)({open:!0,type:"error",msg:e})}}};return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)(s.Z,{color:"blue",variant:"h6",children:["Invoice #",X?(0,n.jsx)(T.Z,{className:"mx-2",size:20}):B.invoice_number+1]}),(0,n.jsxs)(s.Z,{variant:"h6",className:"",children:["Date: ",k]})]}),(0,n.jsxs)("div",{className:" flex items-center flex-wrap",children:[(0,n.jsx)(o.Z,{type:"text",className:"my-2 mr-2",onChange:e=>_(e.target.value),size:"small",label:"Customer Name",value:p,error:C,helperText:C&&"Enter Coustomer Name"}),(0,n.jsx)(o.Z,{type:"text",className:"my-2 ml-0 sm:ml-2",onChange:e=>t(e.target.value),size:"small",label:"Mobile Number",value:e,error:a,helperText:a&&"Enter Coustomer Mobile Number"})]}),(0,n.jsx)(v,{}),(0,n.jsx)("div",{className:"w-screen2",children:(0,n.jsx)(r.P2,{enableBottomToolbar:!0,options:{search:!1,filtering:!1,sorting:!1},enableRowActions:!0,renderBottomToolbar:e=>{let{table:t}=e;return(0,n.jsx)("div",{className:"flex justify-center flex-warap",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)(s.Z,{className:"",variant:"h6",children:["Grand Total : RS ",J]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(o.Z,{type:"number",size:"small",label:"Coustomer Payment",id:"outlined-start-adornment",sx:{m:1,width:"25ch"},InputProps:{startAdornment:(0,n.jsx)(g.Z,{position:"start",children:"RS"})},value:b,onChange:e=>D(e.target.value),error:S,helperText:S&&"Enter Coustomer Payied Amount"}),(0,n.jsx)(y.Z,{onClick:Q,variant:"contained",children:"Bill"})]})]})})},renderRowActions:e=>{let{row:t}=e;return(0,n.jsx)(l.Z,{children:(0,n.jsx)(d.Z,{color:"error",size:"small",onClick:()=>{M((0,h.cl)(t.id))},children:(0,n.jsx)(f.Z,{fontSize:"small"})})})},initialState:{density:"compact"},columns:H,data:U})})]})}},90517:function(e,t,a){"use strict";a.d(t,{At:function(){return s},mX:function(){return o}});let n=(0,a(39730).oM)({name:"snack_bar",initialState:{OPEN:!1,TYPE:"sucess",MSG:""},reducers:{openScackbar:(e,t)=>{let{open:a,type:n,msg:o}=t.payload;e.OPEN=a,e.TYPE=n,e.MSG=o},closeScackbar:e=>{e.OPEN=!1}}}),{openScackbar:o,closeScackbar:s}=n.actions;t.ZP=n.reducer},3291:function(e,t,a){"use strict";a.d(t,{Q5:function(){return s},wn:function(){return o}});let n=(0,a(39730).oM)({name:"invoice_print",initialState:{OPEN:!1,DATA:{}},reducers:{openPrintDialog:(e,t)=>{let{open:a,data:n}=t.payload;e.OPEN=a,e.DATA=n},closePrintDialog:e=>{e.OPEN=!1,e.DATA={}}}}),{openPrintDialog:o,closePrintDialog:s}=n.actions;t.ZP=n.reducer},11854:function(e,t,a){"use strict";a.d(t,{BO:function(){return c},Cj:function(){return r},SA:function(){return o},cl:function(){return i},hc:function(){return s}});let n=(0,a(39730).oM)({name:"invoice_data",initialState:{INVOICE_ITEM:[],GRAND_TOTAL:0,GRAND_TOTAL_COST:0,error:!1},reducers:{addInvoiceItem:(e,t)=>{let a=e.INVOICE_ITEM.findIndex(e=>e.id===t.payload.id);-1===a?e.INVOICE_ITEM.push(t.payload):e.INVOICE_ITEM[a].qty+=t.payload.qty,e.GRAND_TOTAL_COST+=t.payload.cost,e.GRAND_TOTAL+=t.payload.price},addQty:(e,t)=>{e.INVOICE_ITEM[t.payload].qty++,e.GRAND_TOTAL_COST+=e.INVOICE_ITEM[t.payload].cost,e.GRAND_TOTAL+=e.INVOICE_ITEM[t.payload].price},minusQty:(e,t)=>{e.INVOICE_ITEM[t.payload].qty--,e.GRAND_TOTAL-=e.INVOICE_ITEM[t.payload].price,e.GRAND_TOTAL_COST-=e.INVOICE_ITEM[t.payload].cost},removeItem:(e,t)=>{let a=e.INVOICE_ITEM[t.payload];a&&(e.GRAND_TOTAL-=a.price*a.qty,e.GRAND_TOTAL_COST-=a.cost*a.qty,e.INVOICE_ITEM.splice(t.payload,1))},resetInvoice:(e,t)=>{e.INVOICE_ITEM=[],e.GRAND_TOTAL_COST=0,e.GRAND_TOTAL=0}}}),{addInvoiceItem:o,addQty:s,minusQty:r,removeItem:i,resetInvoice:c}=n.actions;t.ZP=n.reducer}},function(e){e.O(0,[358,481,712,704,502,679,274,46,730,19,14,564,215,520,971,938,744],function(){return e(e.s=90154)}),_N_E=e.O()}]);